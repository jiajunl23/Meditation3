<script src="https://cdn.jsdelivr.net/gh/netizenorg/netnet-standard-library/build/nn.min.js"></script>
<script>
/* global nn */

const GIF = "pheo3.gif"

const BACKGROUND_COLOR = "black"

function sleep (ms) {
  return new Promise(resolve => setTimeout(resolve, ms))
}

let GIF_ARRAY = []
  
async function createGIF (x, y) {
  const gif = await nn.loadImage(GIF)
  GIF_ARRAY.push({obj: nn.create("img")
    .set({
      src: GIF
    })
    .css({
    position: "absolute",
    left: x - gif.width / 2,
    top: y - gif.height / 2,
    imageRendering: "pixelated",
    transform: "rotate(90deg)",
    transformOrigin: "center center"
  })
    .addTo("body"), x: x - gif.width / 2, y: y - gif.height / 2})
}

function ph_moves () {
  const length = GIF_ARRAY.length
  for (let i = 0; i < length; i++) {
    const new_x = GIF_ARRAY[i].x + nn.random(-0.5, 0.5)
    const new_y = GIF_ARRAY[i].y + nn.random(-0.5, 0.5)
    GIF_ARRAY[i].obj.css({
      left: new_x,
      top: new_y
    })
    GIF_ARRAY[i].x = new_x
    GIF_ARRAY[i].y = new_y
  }
}
  
async function setup () {
  nn.get("body").css({backgroundColor: BACKGROUND_COLOR})
  
  const gif = await nn.loadImage(GIF)
  
  const num_gifs = 15
  let r = 100
  
  for (let i = 0; i < num_gifs; i++) {
    const center_x = nn.width / 2
    const center_y = nn.height / 2
    let s = 0.5
    const y = center_y + Math.sin(i * s) * r
    const x = center_x + Math.cos(i * s) * r
    await sleep(100)
    createGIF(x, y)
    r += 20
  }
  
  setInterval(ph_moves, 1000 / 60)
}
  
nn.on("load", setup)

</script>